clearnum_meas = 3;total_col = 27; %time, count, 25 data% Data_orig = zeros(0,total_col); % original data which have 900 (should be negative)Data = zeros(0,total_col); DataBig = zeros(0,total_col);% index of the PIR1 from 27 columns% row vectorsindex_PIR1 = ([0 0 kron(ones(1,8), [1 0 0] ) 0] == 1);index_PIR2 = ([0 0 kron(ones(1,8), [0 1 0] ) 0] == 1);index_PIR3 = ([0 0 kron(ones(1,8), [0 0 1] ) 0] == 1);if ~isempty(instrfind)    fclose(instrfind);    delete(instrfind);end% clear portss = serial('COM8');% s = serial('/dev/tty.usbserial-AM0211V4');set(s,'BaudRate',115200);fopen(s);lineCounter = 1;while 1    tline = fscanf(s);    if isempty(tline)        pause(0.1);        sprintf('waiting to connect port');        continue    end        % parse the string    % remove unnecessary characters    tline(1:2) = [];       tline(end-1:end) = [];        pcounter = str2double(tline(end-1:end));    tline(end-1:end) = [];        % parse to 3 measurements    ns = numel(tline);    strMeas = cellstr( reshape( ...        [tline repmat(' ',1,ceil(ns/num_meas)*num_meas-ns)],...        num_meas,[])')';        % line to save    % counter, data, last ambient temp    Meas = str2double(strMeas);    dataLine = [now, pcounter, Meas];               if length(Data(:,1)) >= 100            tempData = Data(2:end,:);            Data = zeros(length(tempData(:,1)),total_col);            Data = tempData;            if length(dataLine) ~= total_col                Data(end,1) = -1;            else                Data(end,:) = dataLine;            end        else                         if length(dataLine) ~= total_col                % corrupted                Data(end+1,1) = -1;            else                Data(end+1,:) = dataLine;            end        end        if length(Data(:,1)) < 100        plot_start = 1;        plot_end = length(Data(:,1));        num_pts = 8*length(Data(:,1));    else        plot_start = lineCounter - 800;        plot_end = lineCounter;        num_pts = 8*100;    end        if ~isempty(Data)                PIR1 = reshape(Data(:,index_PIR1)', num_pts, 1);        PIR2 = reshape(Data(:,index_PIR2)', num_pts,1);        PIR3 = reshape(Data(:,index_PIR3)', num_pts,1);        figure(1)        hold on        plot((plot_start-1)*8+1:plot_end*8, PIR1/10, 'r','LineWidth',3);        plot((plot_start-1)*8+1:plot_end*8, PIR2/10, 'm','LineWidth',3);        plot((plot_start-1)*8+1:plot_end*8, PIR3/10, 'b','LineWidth',3);        %plot((plot_start-1)*8+1:plot_end*8, kron(ambientTmp'/10, ones(1,8)), 'k','LineWidth',3);        grid on        set(gca,'XTick',[])        hold off        % ylim([-5, 10]);        axis auto        legend('PIR1','PIR2','PIR3');        xlabel('Time','FontSize',14);        ylabel('Temperature (C)','FontSize',14);        title('PIR test','FontSize',16);            end     lineCounter = lineCounter+1;     length(PIR1)end% fprintf(s,'*IDN?')% out = fscanf(s);fclose(s)delete(s)clear s